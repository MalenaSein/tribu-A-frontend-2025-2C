<!DOCTYPE html>
<html lang="es">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <title>Sistema de Gestión de Horas - Aprobar Horas</title>
    <link rel="stylesheet" href="../common/globals.css" />
    <link rel="stylesheet" href="../common/styleguide.css" />
    <link rel="stylesheet" href="aprobar_horas.css" />
    <script src="../auth-service.js"></script>
    <script src="../route-guard.js"></script>
    <script src="../config.js"></script>
    <script src="../APIClient.js"></script>

  </head>
  <body>
    <main class="aprobar-horas">
      <!-- HEADER PRINCIPAL -->
      <header class="header">
        <h1 class="header-title">SISTEMA DE GESTIÓN DE HORAS</h1>
        <div class="user-info">
          <span class="user-name">Manager</span>
          <div aria-label="Icono de usuario">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
              <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
          </div>
        </div>
      </header>

      <!-- SECCIÓN DE BÚSQUEDA DE EMPLEADO -->
      <section class="search-section">
        <div class="search-header">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
          </svg>
          <h2 class="search-title">Buscar Empleado</h2>
          <div class="search-field">
            <select id="employeeSelect" class="search-input">
              <option value="">Seleccione un empleado</option>
              <option value="emp1">Juan Pérez - Desarrollador</option>
              <option value="emp2">María González - Desarrollador</option>
              <option value="emp3">Carlos Rodríguez - Desarrollador</option>
              <option value="emp4">Ana Martínez - QA</option>
            </select>
          </div>
        </div>
      </section>

      <!-- SELECTOR DE SEMANA -->
      <section class="week-section hidden" id="weekSection">
        <select id="weekSelect" class="week-select">
          <option value="">Seleccione una semana</option>
          <option value="week1">Semana 1 (04/11 - 08/11)</option>
          <option value="week2">Semana 2 (11/11 - 15/11)</option>
          <option value="week3">Semana 3 (18/11 - 22/11)</option>
        </select>
      </section>

      <!-- ESTADO VACÍO -->
      <div class="empty-state" id="emptyState">
        <p class="empty-text">Seleccione un empleado para ver sus horas cargadas</p>
      </div>

      <!-- TABLA DE HORAS -->
      <section class="hours-table-section hidden" id="hoursSection">
        <div class="table-container">
          <div class="table" role="grid">
            <!-- HEADER -->
            <div class="table-header" role="row">
              <div class="cell-header" role="columnheader">
                <span class="header-text">PROYECTO</span>
              </div>
              <div class="cell-header" role="columnheader">
                <span class="header-text">TAREA</span>
              </div>
              <div class="cell-header cell-day" role="columnheader">
                <span class="header-text">LUN</span>
              </div>
              <div class="cell-header cell-day" role="columnheader">
                <span class="header-text">MAR</span>
              </div>
              <div class="cell-header cell-day" role="columnheader">
                <span class="header-text">MIÉ</span>
              </div>
              <div class="cell-header cell-day" role="columnheader">
                <span class="header-text">JUE</span>
              </div>
              <div class="cell-header cell-day" role="columnheader">
                <span class="header-text">VIE</span>
              </div>
              <div class="cell-header cell-day" role="columnheader">
                <span class="header-text">TOTAL</span>
              </div>
            </div>

            <!-- FILAS DE DATOS -->
            <div id="dataRows"></div>

            <!-- FILA DE TOTALES -->
            <div class="table-row total-row" role="row">
              <div class="cell-data" role="gridcell" colspan="2">
                <span class="cell-text">TOTAL POR DÍA</span>
              </div>
              <div class="cell-data" role="gridcell">
                <span class="cell-text"></span>
              </div>
              <div class="cell-data cell-day" role="gridcell">
                <output class="cell-text" id="total-mon">0.0</output>
              </div>
              <div class="cell-data cell-day" role="gridcell">
                <output class="cell-text" id="total-tue">0.0</output>
              </div>
              <div class="cell-data cell-day" role="gridcell">
                <output class="cell-text" id="total-wed">0.0</output>
              </div>
              <div class="cell-data cell-day" role="gridcell">
                <output class="cell-text" id="total-thu">0.0</output>
              </div>
              <div class="cell-data cell-day" role="gridcell">
                <output class="cell-text" id="total-fri">0.0</output>
              </div>
              <div class="cell-data cell-day" role="gridcell">
                <output class="cell-text" id="grand-total">0.0</output>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- FOOTER -->
      <footer class="footer-section hidden" id="footerSection">
        <div class="footer-info">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
          </svg>
          <p class="footer-text">
            <span>Total semanal del empleado: </span>
            <output id="weeklyTotal">0h</output>
          </p>
          <p class="footer-total">
            <span>Estado: </span>
            <output id="approvalStatus">Pendiente de aprobación</output>
          </p>
        </div>
      </footer>

      <!-- BOTONES DE ACCIÓN -->
      <div class="action-buttons hidden" id="actionButtons">
        <button type="button" class="btn btn-back" onclick="window.location.href='manager-home.html'">
          <span>Volver</span>
        </button>
        <button type="button" class="btn btn-reject" id="rejectBtn">
          <span>Rechazar</span>
        </button>
        <button type="button" class="btn btn-approve" id="approveBtn">
          <span>Aprobar</span>
        </button>
      </div>
    </main>

    <script>
      // Datos de ejemplo
      const employeeData = {
        emp1: {
          name: 'Juan Pérez',
          tasks: [
            { project: 'Proyecto Alpha', task: 'Frontend', hours: { mon: 4, tue: 6, wed: 5, thu: 4, fri: 6 } },
            { project: 'Proyecto Alpha', task: 'Testing', hours: { mon: 2, tue: 1, wed: 2, thu: 3, fri: 1 } },
            { project: 'Proyecto Beta', task: 'API Development', hours: { mon: 2, tue: 1, wed: 1, thu: 1, fri: 1 } }
          ]
        },
        emp2: {
          name: 'María González',
          tasks: [
            { project: 'Proyecto Beta', task: 'Backend', hours: { mon: 5, tue: 5, wed: 6, thu: 5, fri: 5 } },
            { project: 'Proyecto Gamma', task: 'Database', hours: { mon: 3, tue: 3, wed: 2, thu: 3, fri: 3 } }
          ]
        },
        emp3: {
          name: 'Carlos Rodríguez',
          tasks: [
            { project: 'Proyecto Alpha', task: 'UI/UX', hours: { mon: 4, tue: 4, wed: 4, thu: 4, fri: 4 } },
            { project: 'Proyecto Alpha', task: 'Documentation', hours: { mon: 2, tue: 2, wed: 2, thu: 2, fri: 2 } },
            { project: 'Proyecto Beta', task: 'Code Review', hours: { mon: 2, tue: 2, wed: 2, thu: 2, fri: 2 } }
          ]
        },
        emp4: {
          name: 'Ana Martínez',
          tasks: [
            { project: 'Proyecto Alpha', task: 'QA Testing', hours: { mon: 6, tue: 6, wed: 6, thu: 6, fri: 6 } },
            { project: 'Proyecto Beta', task: 'Bug Tracking', hours: { mon: 2, tue: 2, wed: 2, thu: 2, fri: 2 } }
          ]
        }
      };

      // Referencias DOM
      const employeeSelect = document.getElementById('employeeSelect');
      const weekSection = document.getElementById('weekSection');
      const emptyState = document.getElementById('emptyState');
      const hoursSection = document.getElementById('hoursSection');
      const footerSection = document.getElementById('footerSection');
      const actionButtons = document.getElementById('actionButtons');
      const dataRows = document.getElementById('dataRows');
      const approveBtn = document.getElementById('approveBtn');
      const rejectBtn = document.getElementById('rejectBtn');

      let currentEmployee = null;

      // Evento de selección de empleado
      employeeSelect.addEventListener('change', (e) => {
        const empId = e.target.value;
        
        if (empId) {
          currentEmployee = employeeData[empId];
          showHoursTable();
        } else {
          hideHoursTable();
        }
      });

      function showHoursTable() {
        emptyState.classList.add('hidden');
        weekSection.classList.remove('hidden');
        hoursSection.classList.remove('hidden');
        footerSection.classList.remove('hidden');
        actionButtons.classList.remove('hidden');
        
        renderTasks();
        updateTotals();
      }

      function hideHoursTable() {
        emptyState.classList.remove('hidden');
        weekSection.classList.add('hidden');
        hoursSection.classList.add('hidden');
        footerSection.classList.add('hidden');
        actionButtons.classList.add('hidden');
      }

      function renderTasks() {
        if (!currentEmployee) return;
        
        dataRows.innerHTML = '';
        
        currentEmployee.tasks.forEach(task => {
          const row = document.createElement('div');
          row.className = 'table-row';
          row.setAttribute('role', 'row');
          
          row.innerHTML = `
            <div class="cell-data" role="gridcell">
              <span class="cell-text">${task.project}</span>
            </div>
            <div class="cell-data" role="gridcell">
              <span class="cell-text">${task.task}</span>
            </div>
            <div class="cell-data cell-day" role="gridcell">
              <span class="cell-text">${task.hours.mon.toFixed(1)}</span>
            </div>
            <div class="cell-data cell-day" role="gridcell">
              <span class="cell-text">${task.hours.tue.toFixed(1)}</span>
            </div>
            <div class="cell-data cell-day" role="gridcell">
              <span class="cell-text">${task.hours.wed.toFixed(1)}</span>
            </div>
            <div class="cell-data cell-day" role="gridcell">
              <span class="cell-text">${task.hours.thu.toFixed(1)}</span>
            </div>
            <div class="cell-data cell-day" role="gridcell">
              <span class="cell-text">${task.hours.fri.toFixed(1)}</span>
            </div>
            <div class="cell-data cell-day" role="gridcell">
              <span class="cell-text">${(task.hours.mon + task.hours.tue + task.hours.wed + task.hours.thu + task.hours.fri).toFixed(1)}</span>
            </div>
          `;
          
          dataRows.appendChild(row);
        });
      }

      function updateTotals() {
        if (!currentEmployee) return;
        
        const days = ['mon', 'tue', 'wed', 'thu', 'fri'];
        let weekTotal = 0;
        
        days.forEach(day => {
          let dayTotal = 0;
          currentEmployee.tasks.forEach(task => {
            dayTotal += task.hours[day];
          });
          
          const dayElement = document.getElementById(`total-${day}`);
          if (dayElement) {
            dayElement.textContent = dayTotal.toFixed(1);
          }
          
          weekTotal += dayTotal;
        });
        
        document.getElementById('grand-total').textContent = weekTotal.toFixed(1);
        document.getElementById('weeklyTotal').textContent = weekTotal.toFixed(1) + 'h';
      }

      // Botones de acción
      approveBtn.addEventListener('click', () => {
        if (confirm('¿Está seguro de que desea aprobar estas horas?')) {
          document.getElementById('approvalStatus').textContent = 'Aprobado ✓';
          document.getElementById('approvalStatus').style.color = '#2e7d32';
          alert('Horas aprobadas correctamente');
        }
      });

      rejectBtn.addEventListener('click', () => {
        const reason = prompt('Ingrese el motivo del rechazo:');
        if (reason && reason.trim()) {
          document.getElementById('approvalStatus').textContent = 'Rechazado ✗';
          document.getElementById('approvalStatus').style.color = '#c62828';
          alert('Horas rechazadas. El empleado recibirá una notificación.');
        }
      });
    </script>
  </body>
</html>