<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>Costos por proyecto</h1>
    <p>id: <span id="id_proyecto"></span> | nombre <span id="nombre_proyecto"></span></p>
    
    <p id="cargando">cargando...</p>
    <div id="display_costos">

        <p>costo total <span id="costo_total"></span></p>
    
        <hr>
        <h2>Lista de recursos involucrados en el proyecto</h2>
        <li id="lista_de_recursos"></li>
    </div>

    <script src="../../APIClient.js"></script>
    <script>
        let displayCostos = document.querySelector("#display_costos");
        let cargando = document.querySelector("#cargando");
        displayCostos.style.display = 'none';
        const parametros = new URLSearchParams(window.location.search);
        const projectId = parametros.get('id');
        const year = parametros.get('year');
        const name = parametros.get('name');
        const listaDeRecursos = document.querySelector("#lista_de_recursos");
        let idProyecto = document.querySelector("#id_proyecto");
        let nombreProyecto = document.querySelector("#nombre_proyecto");
        let costoTotal = document.querySelector("#costo_total");

        idProyecto.innerHTML = projectId;
        nombreProyecto.innerHTML = name;


        APIClient.getResourcesByProjectAndYear(projectId, year).then(proyecto => {
            
            if(proyecto==null || proyecto.status != 200 ) {
                displayCostos.innerHTML = "<h2>no hay datos disponibles.</h2>";
                displayCostos.style.display = 'block';
                cargando.style.display = 'none';
            } else {

                cargando.style.display = 'none';

                displayCostos.style.display = 'block';
                costoTotal.innerHTML = proyecto.costoTotal;
                const recursos = proyecto.resources;
                proyecto.registros.forEach(registro => {
                    listaDeRecursos.innerHTML += 
                    `<li>id: ${registro.codigoEmpleado}, <strong>nombre:</strong> ${nombreDeRecursoPorId(recursos, registro.codigoEmpleado)}, <strong>tarea:</strong> ${registro.tarea}, horas: ${registro.horas}</li>`;
                });
            }
                
        } );

        function nombreDeRecursoPorId(recursos, id) {
            r = recursos.filter(r => r.id == id)[0];
            return `${r.nombre} ${r.apellido}`;
        }
    </script>
    
</body>
</html>