<!DOCTYPE html>
<html lang="es">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <title>Sistema de Gestión de Horas - Cargar Horas</title>
    <link rel="stylesheet" href="/src/common/globals.css" />
    <link rel="stylesheet" href="/src/common/styleguide.css" />
    <link rel="stylesheet" href="carga_horas.css" />
  </head>
  <body>
    <main class="cargar-horas">
      <!-- HEADER PRINCIPAL -->
      <nav class="rectangle-2" role="navigation">
        <h1 class="p">SISTEMA DE GESTIÓN DE HORAS</h1>
        <div class="user-info">
          <span class="text-wrapper-5">Desarrollador</span>
          <div class="user" aria-label="Icono de usuario">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
              <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
          </div>
        </div>
      </nav>
      
      <!-- HEADER DEL PROYECTO -->
      <section class="project-header">
        <div class="rectangle">
          <svg class="folder" width="24" height="24" viewBox="0 0 24 24" fill="white">
            <path d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/>
          </svg>
          <h2 class="text-wrapper-2" id="proyecto1">Proyecto: Nombre del Proyecto</h2>
          <div class="select-field">
            <label for="week-select" style="position: absolute; width: 1px; height: 1px; overflow: hidden;">Seleccione su semana</label>
            <select id="week-select" class="select" name="week">
              <option value="">Seleccione su semana</option>
              <option value="week1">Semana 1</option>
              <option value="week2">Semana 2</option>
              <option value="week3">Semana 3</option>
            </select>
          </div>
        </div>
      </section>
      
      <!-- TABLA DE HORAS -->
      <section class="hours-table-section">
        <form class="table-basic" aria-label="Tabla de carga de horas">
          <div class="table" role="grid" aria-label="Horas por tarea y día" id="tasksTable">
            <!-- HEADER DE LA TABLA -->
            <div class="row" role="row">
              <div class="cell-header" role="columnheader">
                <div class="content">
                  <span class="text-2">TAREA</span>
                </div>
              </div>
              <div class="content-wrapper" role="columnheader">
                <div class="content">
                  <span class="text-3">LUN</span>
                </div>
              </div>
              <div class="content-wrapper" role="columnheader">
                <div class="content">
                  <span class="text-2">MAR</span>
                </div>
              </div>
              <div class="content-wrapper" role="columnheader">
                <div class="content">
                  <span class="text-2">MIÉ</span>
                </div>
              </div>
              <div class="content-wrapper" role="columnheader">
                <div class="content">
                  <span class="text-2">JUE</span>
                </div>
              </div>
              <div class="content-wrapper" role="columnheader">
                <div class="content">
                  <span class="text-2">VIE</span>
                </div>
              </div>
              <div class="content-wrapper" role="columnheader">
                <div class="content">
                  <span class="text-2">TOTAL</span>
                </div>
              </div>
            </div>
            
            <!-- TAREAS DINÁMICAS -->
            <div id="taskRows"></div>
            
            <!-- FILA DE TOTALES -->
            <div class="row-3" role="row">
              <div class="cell-default" role="rowheader">
                <span class="text-4">TOTAL POR DÍA</span>
              </div>
              <div class="cell-default-2" role="gridcell">
                <output class="text-4 total-output" id="total-mon">0.0</output>
              </div>
              <div class="cell-default-2" role="gridcell">
                <output class="text-4 total-output" id="total-tue">0.0</output>
              </div>
              <div class="cell-default-2" role="gridcell">
                <output class="text-4 total-output" id="total-wed">0.0</output>
              </div>
              <div class="cell-default-2" role="gridcell">
                <output class="text-4 total-output" id="total-thu">0.0</output>
              </div>
              <div class="cell-default-2" role="gridcell">
                <output class="text-4 total-output" id="total-fri">0.0</output>
              </div>
              <div class="cell-default-2" role="gridcell">
                <output class="text-4 total-output" id="grand-total">0.0</output>
              </div>
            </div>
          </div>
        </form>
      </section>
      
      <!-- FOOTER DEL PROYECTO -->
      <footer class="project-footer">
        <div class="div">
          <svg class="folder-2" width="24" height="24" viewBox="0 0 24 24" fill="white">
            <path d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/>
          </svg>
          <p class="subtotal-proyecto">
            <span class="span">Subtotal Proyecto: </span>
            <output class="text-wrapper-4" id="subtotal-output">0h</output>
          </p>
          <p class="text-wrapper-3">
            <span>Total semanal: </span>
            <output id="weekly-total-output">0h</output>
            <span> / 40h asignadas</span>
          </p>
        </div>
      </footer>
      
      <!-- BOTONES DE ACCIÓN -->
      <div class="action-buttons">
        <button type="button" class="button-5" id="addTaskBtn">
          <span>+ Agregar Tarea</span>
        </button>
        <button type="button" class="button-4">
          <span>Cancelar</span>
        </button>
        <button type="submit" class="button-2">
          <span>Guardar Cambios</span>
        </button>
      </div>
    </main>

    <!-- MODAL PARA AGREGAR TAREA -->
    <div class="modal-overlay" id="modalOverlay">
      <div class="modal">
        <div class="modal-header">
          <h2>Agregar Nueva Tarea</h2>
        </div>
        
        <form id="taskForm">
          <div class="modal-body">
            <div class="modal-form-group">
              <label for="taskName">Nombre de la Tarea *</label>
              <input 
                type="text" 
                id="taskName" 
                name="taskName" 
                placeholder="Ingresá el nombre de la tarea"
                required
                autofocus
              />
            </div>
          </div>
          
          <div class="modal-footer">
            <button type="button" class="modal-btn modal-btn-cancel" id="cancelModalBtn">
              Cancelar
            </button>
            <button type="submit" class="modal-btn modal-btn-create">
              Crear Tarea
            </button>
          </div>
        </form>
      </div>
    </div>

    <script src="index.js"></script>
    <script>
      // Estado de la aplicación
      let tasks = [
        { id: 1, name: 'TAREA 1', hours: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 } },
        { id: 2, name: 'TAREA 2', hours: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 } },
        { id: 3, name: 'TAREA 3', hours: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 } }
      ];
      let taskIdCounter = 4;

      // Referencias al DOM
      const modal = document.getElementById('modalOverlay');
      const addTaskBtn = document.getElementById('addTaskBtn');
      const cancelModalBtn = document.getElementById('cancelModalBtn');
      const taskForm = document.getElementById('taskForm');
      const taskNameInput = document.getElementById('taskName');
      const taskRowsContainer = document.getElementById('taskRows');

      // Función para renderizar todas las tareas
      function renderTasks() {
        taskRowsContainer.innerHTML = '';
        
        tasks.forEach(task => {
          const taskRow = createTaskRow(task);
          taskRowsContainer.appendChild(taskRow);
        });
        
        updateTotals();
      }

      // Función para crear una fila de tarea
      function createTaskRow(task) {
        const row = document.createElement('div');
        row.className = 'row-2';
        row.setAttribute('role', 'row');
        row.setAttribute('data-task-id', task.id);
        
        row.innerHTML = `
          <div class="cell-default" role="rowheader">
            <span class="text-4">${task.name}</span>
            <button type="button" class="delete-task-btn" data-task-id="${task.id}" aria-label="Eliminar tarea ${task.name}" title="Eliminar tarea">×</button>
          </div>
          <div class="cell-default-2" role="gridcell">
            <input type="number" class="hour-input" data-task="${task.id}" data-day="mon" 
              min="0" max="24" step="0.5" value="${task.hours.mon || 0}" />
          </div>
          <div class="cell-default-2" role="gridcell">
            <input type="number" class="hour-input" data-task="${task.id}" data-day="tue" 
              min="0" max="24" step="0.5" value="${task.hours.tue || 0}" />
          </div>
          <div class="cell-default-2" role="gridcell">
            <input type="number" class="hour-input" data-task="${task.id}" data-day="wed" 
              min="0" max="24" step="0.5" value="${task.hours.wed || 0}" />
          </div>
          <div class="cell-default-2" role="gridcell">
            <input type="number" class="hour-input" data-task="${task.id}" data-day="thu" 
              min="0" max="24" step="0.5" value="${task.hours.thu || 0}" />
          </div>
          <div class="cell-default-2" role="gridcell">
            <input type="number" class="hour-input" data-task="${task.id}" data-day="fri" 
              min="0" max="24" step="0.5" value="${task.hours.fri || 0}" />
          </div>
          <div class="cell-default-2" role="gridcell">
            <output class="total-output" id="total-task-${task.id}">0.0</output>
          </div>
        `;
        
        return row;
      }

      // Función para actualizar totales
      function updateTotals() {
        const days = ['mon', 'tue', 'wed', 'thu', 'fri'];
        let weekTotal = 0;
        
        // Calcular totales por tarea
        tasks.forEach(task => {
          let taskTotal = 0;
          days.forEach(day => {
            const value = parseFloat(task.hours[day]) || 0;
            taskTotal += value;
          });
          
          const taskTotalElement = document.getElementById(`total-task-${task.id}`);
          if (taskTotalElement) {
            taskTotalElement.textContent = taskTotal.toFixed(1);
          }
          
          weekTotal += taskTotal;
        });
        
        // Calcular totales por día
        days.forEach(day => {
          let dayTotal = 0;
          tasks.forEach(task => {
            dayTotal += parseFloat(task.hours[day]) || 0;
          });
          
          const dayTotalElement = document.getElementById(`total-${day}`);
          if (dayTotalElement) {
            dayTotalElement.textContent = dayTotal.toFixed(1);
          }
        });
        
        // Total general
        const grandTotalElement = document.getElementById('grand-total');
        if (grandTotalElement) {
          grandTotalElement.textContent = weekTotal.toFixed(1);
        }
        
        // Actualizar footer
        document.getElementById('subtotal-output').textContent = weekTotal.toFixed(1) + 'h';
        document.getElementById('weekly-total-output').textContent = weekTotal.toFixed(1) + 'h';
      }

      // Función para eliminar tarea
      function deleteTask(taskId) {
        if (tasks.length <= 1) {
          alert('Debe mantener al menos una tarea en el proyecto.');
          return;
        }
        
        if (confirm('¿Está seguro de que desea eliminar esta tarea?')) {
          tasks = tasks.filter(t => t.id !== taskId);
          renderTasks();
        }
      }

      // Event listener para cambios en inputs de horas
      document.addEventListener('input', (e) => {
        if (e.target.classList.contains('hour-input')) {
          const taskId = parseInt(e.target.dataset.task);
          const day = e.target.dataset.day;
          const value = parseFloat(e.target.value) || 0;
          
          const task = tasks.find(t => t.id === taskId);
          if (task) {
            task.hours[day] = value;
            updateTotals();
          }
        }
      });

      // Event listener para eliminar tareas
      document.addEventListener('click', (e) => {
        if (e.target.classList.contains('delete-task-btn')) {
          const taskId = parseInt(e.target.dataset.taskId);
          deleteTask(taskId);
        }
      });

      // Abrir modal
      addTaskBtn.addEventListener('click', () => {
        modal.classList.add('active');
        setTimeout(() => taskNameInput.focus(), 100);
      });
      
      // Cerrar modal
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          closeModal();
        }
      });
      
      cancelModalBtn.addEventListener('click', closeModal);
      
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.classList.contains('active')) {
          closeModal();
        }
      });
      
      function closeModal() {
        modal.classList.remove('active');
        taskForm.reset();
      }
      
      // Crear tarea
      taskForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const taskName = taskNameInput.value.trim();
        
        if (taskName) {
          const newTask = {
            id: taskIdCounter++,
            name: taskName.toUpperCase(),
            hours: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }
          };
          
          tasks.push(newTask);
          renderTasks();
          closeModal();
        }
      });

      // Renderizar tareas iniciales
      renderTasks();
    </script>

    <script>
      let p1 = document.querySelector("#proyecto1");

      // cargar los proyectos
      let proyectosConTareas = getData();
      // poner los nombres al menos por ahora
      proyectosConTareas.then(p => {
        console.log(p)
        p1.innerHTML =  `Proyecto: ${p[0].nombre}`;
        // poner el nombre de una tarea
        t1 = document.querySelector("[data-task-id='1'] > div > span");
        t2 = document.querySelector("[data-task-id='2'] > div > span");
        t3 = document.querySelector("[data-task-id='3'] > div > span");
        console.log(t1)
        t1.innerHTML = p[0].tasks[0].nombre;
        t2.innerHTML = p[0].tasks[1].nombre;
        t3.innerHTML = p[0].tasks[2].nombre;
      });
    </script>
  </body>
</html>